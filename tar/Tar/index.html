<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Tar (tar.Tar)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">tar</a> &#x00BB; Tar</nav><header class="odoc-preamble"><h1>Module <code><span>Tar</span></code></h1><p>Tar utilities</p><p><em>V3.1.0 - <a href="https://github.com/mirage/ocaml-tar">homepage</a></em></p></header><nav class="odoc-toc"><ul><li><a href="#decoding-and-encoding-of-a-whole-archive">Decoding and encoding of a whole archive</a></li><li><a href="#pure-implementation-of-fold.">Pure implementation of <code>fold</code>.</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-error"><a href="#type-error" class="anchor"></a><code><span><span class="keyword">type</span> error</span><span> = </span><span>[ </span></code><ol><li id="type-error.Checksum_mismatch" class="def variant constructor anchored"><a href="#type-error.Checksum_mismatch" class="anchor"></a><code><span>| </span><span>`Checksum_mismatch</span></code></li><li id="type-error.Corrupt_pax_header" class="def variant constructor anchored"><a href="#type-error.Corrupt_pax_header" class="anchor"></a><code><span>| </span><span>`Corrupt_pax_header</span></code></li><li id="type-error.Zero_block" class="def variant constructor anchored"><a href="#type-error.Zero_block" class="anchor"></a><code><span>| </span><span>`Zero_block</span></code></li><li id="type-error.Unmarshal" class="def variant constructor anchored"><a href="#type-error.Unmarshal" class="anchor"></a><code><span>| </span><span>`Unmarshal <span class="keyword">of</span> string</span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>The type of errors that may occur.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_error"><a href="#val-pp_error" class="anchor"></a><code><span><span class="keyword">val</span> pp_error : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><span>[&lt; <a href="#type-error">error</a> ]</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>pp_error ppf e</code> pretty prints the error <code>e</code> on the formatter <code>ppf</code>.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Header"><a href="#module-Header" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Header/index.html">Header</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Process and create tar file headers.</p></div></div><h2 id="decoding-and-encoding-of-a-whole-archive"><a href="#decoding-and-encoding-of-a-whole-archive" class="anchor"></a>Decoding and encoding of a whole archive</h2><div class="odoc-spec"><div class="spec type anchored" id="type-decode_state"><a href="#type-decode_state" class="anchor"></a><code><span><span class="keyword">type</span> decode_state</span></code></div><div class="spec-doc"><p>The type of the decode state.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-decode_state"><a href="#val-decode_state" class="anchor"></a><code><span><span class="keyword">val</span> decode_state : <span><span class="optlabel">?global</span>:<a href="Header/Extended/index.html#type-t">Header.Extended.t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-decode_state">decode_state</a></span></code></div><div class="spec-doc"><p><code>decode_state ~global ()</code> constructs a decode_state.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-decode"><a href="#val-decode" class="anchor"></a><code><span><span class="keyword">val</span> decode : 
  <span><a href="#type-decode_state">decode_state</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-decode_state">decode_state</a>
   * <span><span>[ <span>`Read of int</span> <span><span>| `Skip</span> of int</span> <span><span>| `Header</span> of <a href="Header/index.html#type-t">Header.t</a></span> ]</span> option</span>
   * <span><a href="Header/Extended/index.html#type-t">Header.Extended.t</a> option</span>,
    <span>[ `Eof <span><span>| `Fatal</span> of <a href="#type-error">error</a></span> ]</span>)</span>
    <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p><code>decode t data</code> decodes <code>data</code> taking the current state <code>t</code> into account. It may result on success in a new state, optionally some action that should be done (<code>`Read</code> or <code>`Skip</code>), or a decoded <code>`Header</code>. Possibly a new global PAX header is provided as well.</p><p>If no <code>`Read</code> or <code>`Skip</code> is returned, the new state should be used with <code>decode</code> with the next <code>Header.length</code> sized string, which will lead to further decoding until <code>`Eof</code> (or an error) occurs.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-encode_header"><a href="#val-encode_header" class="anchor"></a><code><span><span class="keyword">val</span> encode_header : 
  <span><span class="optlabel">?level</span>:<a href="Header/index.html#type-compatibility">Header.compatibility</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="Header/index.html#type-t">Header.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>string list</span>, <span>[&gt; <span>`Msg of string</span> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p><code>encode_header ~level hdr</code> encodes the header with the provided <code>level</code> (defaults to <code>V7</code>) into a list of strings to be written to the disk. Once a header is written, the payload (padded to multiples of <code>Header.length</code>) should follow.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-encode_global_extended_header"><a href="#val-encode_global_extended_header" class="anchor"></a><code><span><span class="keyword">val</span> encode_global_extended_header : 
  <span><span class="optlabel">?level</span>:<a href="Header/index.html#type-compatibility">Header.compatibility</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="Header/Extended/index.html#type-t">Header.Extended.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>string list</span>, <span>[&gt; <span>`Msg of string</span> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p><code>encode_global_extended_header hdr</code> encodes the global extended header as a list of strings.</p></div></div><h2 id="pure-implementation-of-fold."><a href="#pure-implementation-of-fold." class="anchor"></a>Pure implementation of <code>fold</code>.</h2><p><code>fold</code> produces a <code>('a, 'err, 't) t</code> value which can be <b>evaluated</b> by a scheduler (such as <code>lwt</code> or <code>unix</code>). This value describe when we require to <code>Read</code> (like <code>Stdlib.input</code>), <code>Really_read</code> (like <code>Stdlib.really_read</code>) and <code>Seek</code> (like <code>Stdlib.seek_in</code>).</p><p>We can compose these actions with <code>Bind</code>, <code>Return</code> and <code>High</code>. The latter allows you to use a value <code>('a, 't) io</code> that comes from the scheduler used - so you can use an Lwt value (<code>'a Lwt.t</code>) without depending on Lwt (<code>('a, lwt) t</code>) at this stage.</p><p>For further informations, you can look at the paper about Lightweight Higher Kind Polymorphism available <a href="https://www.cl.cam.ac.uk/~jdy22/papers/lightweight-higher-kinded-polymorphism.pdf">here</a>.</p><div class="odoc-spec"><div class="spec type anchored" id="type-io"><a href="#type-io" class="anchor"></a><code><span><span class="keyword">type</span> <span>('a, 't) io</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>('a, 'err, 't) t</span></span><span> = </span></code><ol><li id="type-t.Really_read" class="def variant constructor anchored"><a href="#type-t.Really_read" class="anchor"></a><code><span>| </span><span><span class="constructor">Really_read</span> : int <span class="arrow">&#45;&gt;</span> <span><span>(string, <span class="type-var">'err</span>, <span class="type-var">'t</span>)</span> <a href="#type-t">t</a></span></span></code></li><li id="type-t.Read" class="def variant constructor anchored"><a href="#type-t.Read" class="anchor"></a><code><span>| </span><span><span class="constructor">Read</span> : int <span class="arrow">&#45;&gt;</span> <span><span>(string, <span class="type-var">'err</span>, <span class="type-var">'t</span>)</span> <a href="#type-t">t</a></span></span></code></li><li id="type-t.Seek" class="def variant constructor anchored"><a href="#type-t.Seek" class="anchor"></a><code><span>| </span><span><span class="constructor">Seek</span> : int <span class="arrow">&#45;&gt;</span> <span><span>(unit, <span class="type-var">'err</span>, <span class="type-var">'t</span>)</span> <a href="#type-t">t</a></span></span></code></li><li id="type-t.Bind" class="def variant constructor anchored"><a href="#type-t.Bind" class="anchor"></a><code><span>| </span><span><span class="constructor">Bind</span> : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'err</span>, <span class="type-var">'t</span>)</span> <a href="#type-t">t</a></span> * <span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'err</span>, <span class="type-var">'t</span>)</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'err</span>, <span class="type-var">'t</span>)</span> <a href="#type-t">t</a></span></span></code></li><li id="type-t.Return" class="def variant constructor anchored"><a href="#type-t.Return" class="anchor"></a><code><span>| </span><span><span class="constructor">Return</span> : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'err</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="arrow">&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'err</span>, <span class="type-var">'t</span>)</span> <a href="#type-t">t</a></span></span></code></li><li id="type-t.High" class="def variant constructor anchored"><a href="#type-t.High" class="anchor"></a><code><span>| </span><span><span class="constructor">High</span> : <span><span>(<span><span>(<span class="type-var">'a</span>, <span class="type-var">'err</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span>, <span class="type-var">'t</span>)</span> <a href="#type-io">io</a></span> <span class="arrow">&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'err</span>, <span class="type-var">'t</span>)</span> <a href="#type-t">t</a></span></span></code></li><li id="type-t.Write" class="def variant constructor anchored"><a href="#type-t.Write" class="anchor"></a><code><span>| </span><span><span class="constructor">Write</span> : string <span class="arrow">&#45;&gt;</span> <span><span>(unit, <span class="type-var">'err</span>, <span class="type-var">'t</span>)</span> <a href="#type-t">t</a></span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-really_read"><a href="#val-really_read" class="anchor"></a><code><span><span class="keyword">val</span> really_read : <span>int <span class="arrow">&#45;&gt;</span></span> <span><span>(string, <span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read"><a href="#val-read" class="anchor"></a><code><span><span class="keyword">val</span> read : <span>int <span class="arrow">&#45;&gt;</span></span> <span><span>(string, <span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-seek"><a href="#val-seek" class="anchor"></a><code><span><span class="keyword">val</span> seek : <span>int <span class="arrow">&#45;&gt;</span></span> <span><span>(unit, <span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-let*"><a href="#val-let*" class="anchor"></a><code><span><span class="keyword">val</span> let* : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'err</span>, <span class="type-var">'t</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'err</span>, <span class="type-var">'t</span>)</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'err</span>, <span class="type-var">'t</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-return"><a href="#val-return" class="anchor"></a><code><span><span class="keyword">val</span> return : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'err</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'err</span>, <span class="type-var">_</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write"><a href="#val-write" class="anchor"></a><code><span><span class="keyword">val</span> write : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(unit, <span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-fold"><a href="#type-fold" class="anchor"></a><code><span><span class="keyword">type</span> <span>('a, 'err, 't) fold</span></span><span> =
  <span><span>(<span><span class="optlabel">?global</span>:<a href="Header/Extended/index.html#type-t">Header.Extended.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Header/index.html#type-t">Header.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'err</span>, <span class="type-var">'t</span>)</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'err</span>, <span class="type-var">'t</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold"><a href="#val-fold" class="anchor"></a><code><span><span class="keyword">val</span> fold : <span><span>(<span class="type-var">'a</span>, <span>[&gt; <span>`Fatal of <a href="#type-error">error</a></span> ]</span>, <span class="type-var">'t</span>)</span> <a href="#type-fold">fold</a></span></span></code></div><div class="spec-doc"><p><code>fold f</code> is a <code>_ t</code> that reads an archive and executes <code>f</code> on each header. <code>f</code> is expected to either read or skip the file contents, or return an error.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-content"><a href="#type-content" class="anchor"></a><code><span><span class="keyword">type</span> <span>('err, 't) content</span></span><span> = <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>string option</span>, <span class="type-var">'err</span>, <span class="type-var">'t</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-entry"><a href="#type-entry" class="anchor"></a><code><span><span class="keyword">type</span> <span>('err, 't) entry</span></span><span> =
  <span><a href="Header/index.html#type-compatibility">Header.compatibility</a> option</span> * <a href="Header/index.html#type-t">Header.t</a> * <span><span>(<span class="type-var">'err</span>, <span class="type-var">'t</span>)</span> <a href="#type-content">content</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-entries"><a href="#type-entries" class="anchor"></a><code><span><span class="keyword">type</span> <span>('err, 't) entries</span></span><span> = <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span><span>(<span class="type-var">'err</span>, <span class="type-var">'t</span>)</span> <a href="#type-entry">entry</a></span> option</span>, <span class="type-var">'err</span>, <span class="type-var">'t</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-out"><a href="#val-out" class="anchor"></a><code><span><span class="keyword">val</span> out : 
  <span><span class="optlabel">?level</span>:<a href="Header/index.html#type-compatibility">Header.compatibility</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?global_hdr</span>:<a href="Header/Extended/index.html#type-t">Header.Extended.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span>[&gt; <span>`Msg of string</span> ]</span> <span class="keyword">as</span> 'err, <span class="type-var">'t</span>)</span> <a href="#type-entries">entries</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(unit, <span class="type-var">'err</span>, <span class="type-var">'t</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>out hdr entries</code> is a <code>_ t</code> that writes <code>entries</code> into an archive. <code>hdr</code> is the global header and each entry must come from a <a href="#type-content"><code>content</code></a> stream and the associated header.</p></div></div></div></body></html>
